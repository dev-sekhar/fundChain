<!DOCTYPE html>
<html>
<!-- 
To run a local web server, use the following command in your terminal:
python -m http.server 8000

This command starts a simple HTTP server on port 8000, allowing you to serve 
your HTML and JSON files over HTTP. This is useful for testing web applications 
in a local environment and avoids CORS issues that can occur when opening 
HTML files directly from the file system.
-->
<head>
    <title>Requirements Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Arimo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Arimo', sans-serif; /* Updated font family to Arimo */
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #0F0D46; /* Header background color */
            color: white; /* Header text color */
            font-weight: bold; /* Header text bold */
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #f1f1f1; /* Highlight row on hover */
        }
        .header {
            text-align: center;
            padding: 20px;
        }
        .group-header {
            background-color: #e6e6e6;
            font-weight: bold;
        }
        .complete {
            color: #197A24; /* Color for complete status */
        }
        .incomplete {
            color: black; /* Default color for incomplete status */
        }
    </style>
    <script>
        async function loadRequirements() {
            const response = await fetch('req-arch-comp.json');
            const data = await response.json();
            const tableBody = document.getElementById('requirementsTableBody');

            // Set the project name in the header
            document.getElementById('projectName').textContent = `${data.projectName}: Requirements Tracker`;

            data.steps.forEach(group => {
                const groupRow = document.createElement('tr');
                groupRow.className = 'group-header';
                groupRow.innerHTML = `<td colspan="8">${group.title}</td>`;
                tableBody.appendChild(groupRow);

                group.requirements.forEach(req => {
                    const row = document.createElement('tr');
                    const functionalRequirement = req.functionalRequirement || req;
                    const details = req.details ? req.details.join(', ') : '';

                    row.innerHTML = `
                        <td></td>
                        <td>${functionalRequirement}</td>
                        <td>${details}</td>
                        <td></td>
                        <td><input type="checkbox" class="coding" onchange="updateCompletion(this, '${functionalRequirement}')" /></td>
                        <td><input type="checkbox" class="testing" onchange="updateCompletion(this, '${functionalRequirement}')" /></td>
                        <td><input type="checkbox" class="deployment" onchange="updateCompletion(this, '${functionalRequirement}')" /></td>
                        <td class="completion incomplete">Incomplete</td>
                    `;
                    tableBody.appendChild(row);
                });
            });

            loadCheckboxStates();
        }

        function updateCompletion(checkbox, functionalRequirement) {
            const row = checkbox.closest('tr');
            const codingCheckbox = row.querySelector('.coding');
            const testingCheckbox = row.querySelector('.testing');
            const deploymentCheckbox = row.querySelector('.deployment');
            const completionCell = row.querySelector('.completion');

            // Check if all checkboxes are checked
            if (codingCheckbox.checked && testingCheckbox.checked && deploymentCheckbox.checked) {
                completionCell.textContent = 'Complete';
                completionCell.classList.remove('incomplete');
                completionCell.classList.add('complete');
            } else {
                completionCell.textContent = 'Incomplete';
                completionCell.classList.remove('complete');
                completionCell.classList.add('incomplete');
            }

            // Save checkbox states
            saveCheckboxStates(functionalRequirement, codingCheckbox.checked, testingCheckbox.checked, deploymentCheckbox.checked);
        }

        function saveCheckboxStates(functionalRequirement, coding, testing, deployment) {
            const states = {
                coding,
                testing,
                deployment
            };
            localStorage.setItem(functionalRequirement, JSON.stringify(states));
        }

        function loadCheckboxStates() {
            const rows = document.querySelectorAll('tr:not(.group-header)');
            rows.forEach(row => {
                const functionalRequirementCell = row.querySelector('td:nth-child(2)');
                if (functionalRequirementCell) {
                    const functionalRequirement = functionalRequirementCell.textContent;
                    const states = JSON.parse(localStorage.getItem(functionalRequirement));

                    if (states) {
                        const codingCheckbox = row.querySelector('.coding');
                        const testingCheckbox = row.querySelector('.testing');
                        const deploymentCheckbox = row.querySelector('.deployment');

                        if (codingCheckbox) codingCheckbox.checked = states.coding;
                        if (testingCheckbox) testingCheckbox.checked = states.testing;
                        if (deploymentCheckbox) deploymentCheckbox.checked = states.deployment;

                        updateCompletion(codingCheckbox, functionalRequirement);
                    }
                }
            });
        }

        window.onload = loadRequirements;
    </script>
</head>
<body>
    <div class="header">
        <h1 id="projectName">Requirements Tracker</h1>
    </div>
    <table>
        <tr>
            <th>Group</th>
            <th>Functional Requirement</th>
            <th>Details</th>
            <th>Architecture Layer</th>
            <th>Coding</th>
            <th>Testing</th>
            <th>Deployment</th>
            <th>Completion</th>
        </tr>
        <tbody id="requirementsTableBody"></tbody>
    </table>
</body>
</html>